<div class="container mt-4">
  <!-- Header -->
  <div class="text-center mb-4">
    <h1 class="fw-bold">Parking Reports</h1>
    <p class="text-muted">Daily summary of parking activities</p>
  </div>

  <!-- Stats Section -->
  <div class="row g-4 mb-4">
    <div class="col-md-12">
      <div class="card text-center shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted">Total Spots</h6>
          <h3 class="fw-bold text-primary">{{parkingSpotArray.length}}</h3>
        </div>
      </div>
    </div>
  </div>

  <div class="cards shadow-sm border-0 rounded-4">
    <div class="card-bodys">
      <h5 class="mb-4 fw-semibold">Select Location</h5>

      <div class="row g-3">
        <!-- Select Site -->
        <div class="col-12 col-md-4">
          <label class="form-label">Select Site</label>
          <select class="form-select" [(ngModel)]="siteId" (change)="onSiteSelect()">
            <option selected disabled>Choose site...</option>
            <option [value]="site.siteId" *ngFor="let site of siteList">{{site.siteName}}</option>
          </select>
        </div>

        <!-- Select Building -->
        <div class="col-12 col-md-4">
          <label class="form-label">Select Building</label>
          <select class="form-select" [(ngModel)]="buildingId" (change)="onBuildingSelect()">
            <option selected disabled>Choose building...</option>
            <option [value]="building.buildingId" *ngFor="let building of buildingList">{{building.buildingName}}
            </option>
          </select>
        </div>

        <!-- Select Floor -->
        <div class="col-12 col-md-4">
          <label class="form-label">Select Floor</label>
          <select class="form-select" [(ngModel)]="floorId" (change)="onFloorSelect()">
            <option selected disabled>Choose floor...</option>
            <option [value]="floor.floorId" *ngFor="let floor of floorList">{{floor.floorNo}}</option>
          </select>
        </div>
      </div>

    </div>
  </div>

  <!-- Parking Spots Layout -->
  <div class="parking-layout" id="parkingLayout">
    @for(spot of parkingSpotArray ; track $index){
    <ng-container *ngIf="checkIfBooked(spot) as bookInf">
      <div class="parking-spot occupied" (click)="openReleaseModel(bookInf.parkId)">
        <i class="bi bi-p-square"></i>
        <div class="spot-number">{{spot}}</div>
        <div class="spot-status">Occupied</div>
        <div class="vehicle-info">{{bookInf.vehicleNo}}</div>
      </div>
    </ng-container>

    <ng-container *ngIf="!checkIfBooked(spot) as bookInf">
      <div class="parking-spot available" (click)="openModel(spot)">
        <i class="bi bi-p-square"></i>
        <div class="spot-number">{{spot}}</div>
        <div class="spot-status">Available</div>
      </div>
    </ng-container>
    }
  </div>

  <div #bookSpot id="bookSpotModal" tabindex="-1" aria-hidden="true" class="modal" style="display: none">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">
            <i class="bi bi-car-front me-2"></i> Book Parking Spot
          </h5>
          <button type="button" data-bs-dismiss="modal" aria-label="Close" class="btn-close btn-close-white"
            (click)="closeModel()"></button>
        </div>

        <div class="modal-body">
          <form novalidate="" id="bookSpotForm" class="ng-untouched ng-pristine ng-invalid">
            <div class="mb-3">
              <label class="form-label">Park Spot No</label>
              <input type="text" name="parkSpotNo" readonly="" [(ngModel)]="bookSpotObj.parkSpotNo"
                class="form-control ng-untouched ng-pristine ng-valid" />
            </div>
            <div class="mb-3">
              <label for="vehicleNumber" class="form-label">Vehicle Number</label>
              <input type="text" name="vehicleNo" id="vehicleNumber" placeholder="Enter vehicle number" required=""
                [(ngModel)]="bookSpotObj.vehicleNo" class="form-control ng-untouched ng-pristine ng-invalid" />
            </div>
            <div class="mb-3">
              <label for="vehicleType" class="form-label">Amount</label>
              <input type="number" name="amount" id="vehicleNumber" placeholder="Enter Amount " required=""
                [(ngModel)]="bookSpotObj.amount" class="form-control ng-untouched ng-pristine ng-valid" />
            </div>
            <div class="mb-3">
              <label for="driverName" class="form-label">Customer Name</label>
              <input type="text" name="custName" id="driverName" placeholder="Customer name"
                class="form-control ng-untouched ng-pristine ng-valid" [(ngModel)]="bookSpotObj.custName" />
            </div>
            <div class="mb-3">
              <label for="contactNumber" class="form-label">Contact Number</label>
              <input type="text" name="custMobileNo" id="contactNumber" placeholder="Enter contact number"
                class="form-control ng-untouched ng-pristine ng-valid" [(ngModel)]="bookSpotObj.custMobileNo" />
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" data-bs-dismiss="modal" class="btn btn-outline-secondary"
            (click)="closeModel()">Cancel</button>
          <button type="button" id="confirmBookBtn" class="btn btn-primary" (click)="onBookSpot()">
            <i class="bi bi-check2-circle me-1"></i> Confirm Booking
          </button>
        </div>
      </div>
    </div>
  </div>


  <div #releasespot id="releaseSpotModal" tabindex="-1" aria-hidden="true" class="modal" style="display: none">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">
            <i class="bi bi-car-front me-2"></i> Release Parking Spot
          </h5>
          <button type="button" data-bs-dismiss="modal" aria-label="Close" class="btn-close btn-close-white" (click)="closeReleaseModel()"></button>
        </div>
        <div class="modal-body">
          <form novalidate="" id="releaseSpotForm" class="ng-valid ng-touched ng-dirty">
            <div class="mb-3">
              <label for="exitTime" class="form-label">Extra Amount</label>
              <input type="text" id="exitTime" class="form-control ng-valid ng-touched ng-dirty" name="extraCharge" [(ngModel)]="markExitObj.extraCharge"/>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" data-bs-dismiss="modal" class="btn btn-outline-secondary" (click)="closeReleaseModel()">
            Cancel</button>
            <button type="button" id="confirmReleaseBtn" class="btn btn-success" (click)="onExitCar()">
            <i class="bi bi-check2-circle me-1"></i> Confirm Release
          </button>
        </div>
      </div>
    </div>
  </div>


</div>